<html>
	<style>

			.telly{
				display: inline-block;
				width: 16%;
			}

			.ruleString{
			}

			canvas{
				left: 0px;
				top: 0px;
				//position: absolute;
				border: 1px solid black;
				border-radius: 2em;
			}
	</style>


<script src="lsystem.js"></script>

<script src="handlebars-v3.0.0.js"></script>

<script id="canvas-template" type="text/x-handlebars-template">
	<div class="telly">
		<canvas id="view{{number}}" width= "200" height ="200"> Can't see me! </canvas>
		<div class="ruleString">{{rules1}}<br/>{{rules2}}</div>
	</div>
</script>

	<div id="infobox"></div>

	<div id="canvasses">

	</div>



<script>

//[0,x]
function randomNumber(x){
	return Math.floor((Math.random() * x) + 1);
}

var possible = ['F', '+', '-', 'E'];

function singleRuleRandom(x){
	var retval = "";
	for(var ii = 0; ii < x; ii++){
		retval += String(possible[randomNumber(possible.length-1)]);
	}
	return retval;
}

function ruleSetRandom(){
	var rule = 	{
				'F': singleRuleRandom(10),
				'E': singleRuleRandom(10)
			};
	return rule;
}

document.addEventListener("DOMContentLoaded", function(){
	var source   = document.getElementById("canvas-template").innerHTML;
	var template = Handlebars.compile(source);
	var html;
	var injectTo = document.getElementById("canvasses");

	var systems = [];
	var renderers = [];

	var data, system, renderer, canvas1, ii, kk;

	var stop = 24;

	var ruleSet = [];

	for(ii = 0; ii < stop; ii++){
		ruleSet.push(ruleSetRandom());
	}

	console.log(ruleSet);

	for(ii = 0; ii < stop; ii++){

		console.log('view' + String(ii));
		var noBracket = JSON.stringify(ruleSet[ii]).replace("}", "").replace("{","");
		var twoString = noBracket.split(",");
		html = template({number: ii, rules1: twoString[0], rules2: twoString[1]});
		injectTo.innerHTML += html;
	}
	for(ii = 0; ii < stop; ii++){

		canvas1 = document.getElementById('view' + String(ii));
		canvas1.dataset.index = ii;

		//F and E are foreword, + is turn positive (cclockwise), - is turn negative (clockwise)
		data = String("F");
		rule = ruleSet[ii];	//console.log(rule);
		/*rule = {		//dragon curve
			'F': 'F+E+',
			'E': '-F-E'
			}
		*/
		system = new Lsystem(data, rule);
	
		for(var kk = 0; kk < 8; kk++){
			system.step();
		}

		renderer = new LSystemRenderer(system, canvas1);
		renderer.draw();

		systems.push(system);
		renderers.push(renderer);

		canvas1.addEventListener('click', function() {
			var ruleString = JSON.stringify(systems[this.dataset.index].productionRules);
			document.querySelector('#infobox').innerHTML = ruleString;
		}, false);
	}
});

/*
	//drawing every step

	setInterval(function(){
		ctx.clearRect(0, 0, canvas1.width, canvas1.height);
		system.step();
		draw();
		}, 200);
		
	

*/

</script>





</html>
